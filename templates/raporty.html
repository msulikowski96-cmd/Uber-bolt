
<!DOCTYPE html>
<html lang="pl">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YREKGGTGVE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-YREKGGTGVE');
    </script>
    <script type="text/javascript" src="https://embeds.iubenda.com/widgets/04ffaacd-a4ef-4ca4-9460-a12f132b2d88.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raporty i Finanse - Taxi Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-dark bg-gradient sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="{{ url_for('index') }}">
                <i class="bi bi-taxi-front"></i> Taxi Calculator
            </a>
            <div class="d-flex align-items-center gap-3">
                <a href="{{ url_for('index') }}" class="text-white"><i class="bi bi-calculator"></i></a>
                <a href="{{ url_for('statystyki') }}" class="text-white"><i class="bi bi-graph-up"></i></a>
                <a href="{{ url_for('platformy') }}" class="text-white"><i class="bi bi-diagram-3"></i></a>
                <a href="{{ url_for('historia') }}" class="text-white"><i class="bi bi-clock-history"></i></a>
                <a href="{{ url_for('raporty') }}" class="text-white"><i class="bi bi-file-earmark-bar-graph-fill"></i></a>
                <a href="{{ url_for('ai_asystent') }}" class="text-white"><i class="bi bi-robot"></i></a>
                <a href="{{ url_for('logout') }}" class="text-white"><i class="bi bi-box-arrow-right"></i></a>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <h2 class="mb-4"><i class="bi bi-file-earmark-bar-graph"></i> Raporty i Finanse</h2>

        <!-- Wyb贸r okresu -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Wybierz okres raportu</h5>
                <div class="row g-3">
                    <div class="col-md-3">
                        <select class="form-select" id="okresTyp">
                            <option value="tydzien">Tydzie</option>
                            <option value="miesiac" selected>Miesic</option>
                            <option value="kwartal">Kwarta</option>
                            <option value="rok">Rok</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <input type="month" class="form-control" id="okresData" value="">
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-primary w-100" onclick="generujRaport()">
                            <i class="bi bi-file-earmark-text"></i> Generuj Raport
                        </button>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-success w-100" onclick="eksportujRaport()">
                            <i class="bi bi-download"></i> Eksportuj PDF
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Podsumowanie okresu -->
        <div class="row g-3 mb-4" id="podsumowanieOkresu">
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="text-muted">Zarobki brutto</h6>
                        <h3 id="zarobkiBrutto">0 z</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="text-muted">Zarobki netto</h6>
                        <h3 id="zarobkiNetto">0 z</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="text-muted">Liczba kurs贸w</h6>
                        <h3 id="liczbaKursow">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="text-muted">Przejechane km</h6>
                        <h3 id="przejechaneKm">0 km</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rozbudowany kalkulator podatk贸w -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-receipt-cutoff"></i> Zaawansowany Kalkulator Podatkowy</h5>
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Forma opodatkowania</label>
                            <select class="form-select" id="formaPodatkowa" onchange="obliczPodatki()">
                                <option value="ryczalt">Ryczat 8.5% (transport osobowy)</option>
                                <option value="ryczalt_12">Ryczat 12.5% (inne usugi)</option>
                                <option value="liniowy">Podatek liniowy 19%</option>
                                <option value="skala">Skala podatkowa (17%/32%)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Przychody miesiczne (brutto)</label>
                            <input type="number" class="form-control" id="przychodBrutto" value="0" oninput="obliczPodatki()">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Typ koszt贸w uzyskania przychodu</label>
                            <select class="form-select" id="typKosztow" onchange="obliczPodatki()">
                                <option value="20">20% przychod贸w (max 120k rocznie)</option>
                                <option value="50">50% przychod贸w (ewidencja przebiegu)</option>
                                <option value="rzeczywiste">Koszty rzeczywiste</option>
                            </select>
                        </div>
                        <div class="mb-3" id="kosztRzeczywiste" style="display:none;">
                            <label class="form-label">Koszty rzeczywiste (paliwo, naprawy, etc.)</label>
                            <input type="number" class="form-control" id="kosztyRzeczywiste" value="0" oninput="obliczPodatki()">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Dodatkowe koszty (abonament, myjnia, etc.)</label>
                            <input type="number" class="form-control" id="dodatkoweKoszty" value="0" oninput="obliczPodatki()">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Czy masz ulg na start? (6 msc bez ZUS)</label>
                            <select class="form-select" id="ulgaNaStart" onchange="obliczPodatki()">
                                <option value="nie">Nie</option>
                                <option value="tak">Tak</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="alert alert-success">
                            <h6><i class="bi bi-calculator"></i> Szczeg贸owe wyliczenie:</h6>
                            <table class="table table-sm mb-0">
                                <tr>
                                    <td>Przych贸d:</td>
                                    <td class="text-end"><strong id="podPrzychod">0 z</strong></td>
                                </tr>
                                <tr>
                                    <td>Koszty uzyskania:</td>
                                    <td class="text-end"><strong id="podKoszty">0 z</strong></td>
                                </tr>
                                <tr class="border-top">
                                    <td>Doch贸d:</td>
                                    <td class="text-end"><strong id="podDochod">0 z</strong></td>
                                </tr>
                                <tr class="border-top">
                                    <td>Podatek dochodowy:</td>
                                    <td class="text-end"><strong id="podPIT">0 z</strong></td>
                                </tr>
                                <tr>
                                    <td>Skadka zdrowotna (9%):</td>
                                    <td class="text-end"><strong id="podZdrowotna">0 z</strong></td>
                                </tr>
                                <tr>
                                    <td>ZUS (skadki spoeczne):</td>
                                    <td class="text-end"><strong id="podZUS">0 z</strong></td>
                                </tr>
                                <tr class="border-top">
                                    <td colspan="2"><strong>Skadki ZUS szczeg贸owo:</strong></td>
                                </tr>
                                <tr>
                                    <td class="ps-3">- Emerytalna:</td>
                                    <td class="text-end" id="zusEmerytalna">0 z</td>
                                </tr>
                                <tr>
                                    <td class="ps-3">- Rentowa:</td>
                                    <td class="text-end" id="zusRentowa">0 z</td>
                                </tr>
                                <tr>
                                    <td class="ps-3">- Chorobowa (dobrowolna):</td>
                                    <td class="text-end" id="zusChorobowa">0 z</td>
                                </tr>
                                <tr>
                                    <td class="ps-3">- Wypadkowa:</td>
                                    <td class="text-end" id="zusWypadkowa">0 z</td>
                                </tr>
                                <tr class="border-top">
                                    <td><strong>SUMA OBCI呕E:</strong></td>
                                    <td class="text-end"><strong id="sumaObciazen">0 z</strong></td>
                                </tr>
                                <tr class="border-top">
                                    <td><strong>DO WYPATY:</strong></td>
                                    <td class="text-end"><strong class="text-success" id="podNetto">0 z</strong></td>
                                </tr>
                            </table>
                        </div>
                        <div class="alert alert-info">
                            <small>
                                <i class="bi bi-info-circle"></i> <strong>Wyliczenia na rok 2025</strong><br>
                                - Minimalna podstawa ZUS: 4694,40 z<br>
                                - Ulga na start: brak ZUS przez 6 msc (max do 30 roku 偶ycia)<br>
                                - Preferencyjny ZUS: 30% podstawy przez 24 msc<br>
                                <span id="efektywnaSkladka"></span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Prognoza roczna -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-calendar-check"></i> Prognoza Roczna</h5>
                <div class="row">
                    <div class="col-md-8">
                        <div id="prognozaRocznaWykres"></div>
                    </div>
                    <div class="col-md-4">
                        <div class="alert alert-primary">
                            <h6>Przewidywane roczne:</h6>
                            <ul class="mb-0">
                                <li>Przych贸d: <strong id="progPrzychod">0 z</strong></li>
                                <li>Koszty: <strong id="progKoszty">0 z</strong></li>
                                <li>Podatek: <strong id="progPodatek">0 z</strong></li>
                                <li>ZUS: <strong id="progZUS">0 z</strong></li>
                                <li class="border-top pt-2 mt-2">Netto: <strong id="progNetto">0 z</strong></li>
                            </ul>
                        </div>
                        <div class="alert alert-warning">
                            <small><i class="bi bi-exclamation-triangle"></i> Prognozy oparte na rednich z ostatnich 3 miesicy</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Prognoza zarobk贸w -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-graph-up-arrow"></i> Prognoza Zarobk贸w</h5>
                <div class="row">
                    <div class="col-md-6">
                        <div id="prognozaWykres"></div>
                    </div>
                    <div class="col-md-6">
                        <div class="alert alert-info">
                            <h6><i class="bi bi-info-circle"></i> Przewidywane zarobki</h6>
                            <p class="mb-2">Na podstawie ostatnich <strong id="dniHistorii">30</strong> dni:</p>
                            <ul class="mb-0">
                                <li>Ten miesic: <strong id="prognozaMiesiac">0 z</strong></li>
                                <li>rednia dzienna: <strong id="sredniaDzienna">0 z</strong></li>
                                <li>Trend: <strong id="trendInfo">stabilny</strong></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Licznik kilometr贸w -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-speedometer2"></i> Licznik Kilometr贸w i Koszt贸w Eksploatacji</h5>
                <div class="row">
                    <div class="col-md-3">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <h6 class="text-muted">Cakowity przebieg</h6>
                                <h2 id="calkowitePrzejechane">0 km</h2>
                                <small class="text-muted">Od pocztku</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <h6 class="text-muted">W tym miesicu</h6>
                                <h2 id="przebiegMiesiac">0 km</h2>
                                <small class="text-muted">rednio <span id="sredniaDzienKm">0</span> km/dzie</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <h6 class="text-muted">Koszt paliwa/km</h6>
                                <h2 id="kosztNaKm">0 z</h2>
                                <small class="text-muted">redni koszt</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <h6 class="text-muted">Koszty cakowite</h6>
                                <h2 id="kosztyEksploatacji">0 z</h2>
                                <small class="text-muted">Ten miesic</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bud偶et miesiczny -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-piggy-bank"></i> Bud偶et Miesiczny</h5>
                <div class="row">
                    <div class="col-md-6">
                        <h6>Wydatki stae</h6>
                        <div class="mb-2">
                            <label class="form-label">Rata pojazdu/leasing</label>
                            <input type="number" class="form-control" id="budRata" value="0" oninput="obliczBudzet()">
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Ubezpieczenie</label>
                            <input type="number" class="form-control" id="budUbezpieczenie" value="0" oninput="obliczBudzet()">
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Prowizje platform</label>
                            <input type="number" class="form-control" id="budProwizje" value="0" oninput="obliczBudzet()">
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Przegldy i naprawy (szacunkowo)</label>
                            <input type="number" class="form-control" id="budNaprawy" value="0" oninput="obliczBudzet()">
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Inne koszty</label>
                            <input type="number" class="form-control" id="budInne" value="0" oninput="obliczBudzet()">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6>Podsumowanie bud偶etu</h6>
                        <div class="alert alert-primary">
                            <table class="table table-sm mb-0">
                                <tr>
                                    <td>Przychody:</td>
                                    <td class="text-end"><strong id="budPrzychody">0 z</strong></td>
                                </tr>
                                <tr>
                                    <td>Koszty stae:</td>
                                    <td class="text-end"><strong id="budKosztyStale">0 z</strong></td>
                                </tr>
                                <tr>
                                    <td>Podatki i ZUS:</td>
                                    <td class="text-end"><strong id="budPodatki">0 z</strong></td>
                                </tr>
                                <tr class="border-top">
                                    <td><strong>Zostaje:</strong></td>
                                    <td class="text-end"><strong id="budZostaje" class="text-success">0 z</strong></td>
                                </tr>
                            </table>
                        </div>
                        <div id="budWykres"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer z linkami prawnymi -->
    <footer class="container-fluid mt-5 py-3 text-center" style="background: rgba(0,0,0,0.05); border-top: 1px solid rgba(0,0,0,0.1);">
        <div class="d-flex justify-content-center gap-3 flex-wrap">
            <a href="https://www.iubenda.com/privacy-policy/77417804" class="iubenda-nostyle no-brand iubenda-noiframe iubenda-embed iub-legal-only iubenda-noiframe text-muted" title="Polityka prywatnoci">Polityka prywatnoci</a>
            <span class="text-muted">|</span>
            <a href="https://www.iubenda.com/privacy-policy/77417804/cookie-policy" class="iubenda-nostyle no-brand iubenda-noiframe iubenda-embed iub-legal-only iubenda-noiframe text-muted" title="Polityka plik贸w cookie">Polityka plik贸w cookie</a>
            <span class="text-muted">|</span>
            <a href="https://www.iubenda.com/zasady-i-warunki/77417804" class="iubenda-nostyle no-brand iubenda-noiframe iubenda-embed iub-legal-only iubenda-noiframe text-muted" title="Zasady i warunki">Zasady i warunki</a>
            <span class="text-muted">|</span>
            <a href="https://www.iubenda.com/dsar-form/pl/04ffaacd-a4ef-4ca4-9460-a12f132b2d88" class="iubenda-white iubenda-embed iubenda-noiframe text-muted" title="Formularz DSAR">Formularz DSAR</a>
        </div>
    </footer>
    <script type="text/javascript">(function (w,d) {var loader = function () {var s = d.createElement("script"), tag = d.getElementsByTagName("script")[0]; s.src="https://cdn.iubenda.com/iubenda.js"; tag.parentNode.insertBefore(s,tag);}; if(w.addEventListener){w.addEventListener("load", loader, false);}else if(w.attachEvent){w.attachEvent("onload", loader);}else{w.onload = loader;}})(window, document);</script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Ustaw bie偶cy miesic
        const dzisiaj = new Date();
        document.getElementById('okresData').value = dzisiaj.toISOString().slice(0, 7);

        // Poka偶/ukryj koszty rzeczywiste
        document.getElementById('typKosztow').addEventListener('change', function() {
            if (this.value === 'rzeczywiste') {
                document.getElementById('kosztRzeczywiste').style.display = 'block';
            } else {
                document.getElementById('kosztRzeczywiste').style.display = 'none';
            }
        });

        async function generujRaport() {
            const typ = document.getElementById('okresTyp').value;
            const data = document.getElementById('okresData').value;
            
            const response = await fetch(`/api/raport?typ=${typ}&data=${data}`);
            const dane = await response.json();
            
            document.getElementById('zarobkiBrutto').textContent = dane.zarobki_brutto + ' z';
            document.getElementById('zarobkiNetto').textContent = dane.zarobki_netto + ' z';
            document.getElementById('liczbaKursow').textContent = dane.liczba_kursow;
            document.getElementById('przejechaneKm').textContent = dane.przejechane_km + ' km';
            
            // Ustaw przych贸d w kalkulatorze
            document.getElementById('przychodBrutto').value = dane.zarobki_brutto;
            obliczPodatki();
        }

        async function ladujPrognoze() {
            const response = await fetch('/api/prognoza');
            const dane = await response.json();
            
            document.getElementById('dniHistorii').textContent = dane.dni_historii;
            document.getElementById('prognozaMiesiac').textContent = dane.prognoza_miesiac + ' z';
            document.getElementById('sredniaDzienna').textContent = dane.srednia_dzienna + ' z';
            document.getElementById('trendInfo').textContent = dane.trend;
            
            Plotly.newPlot('prognozaWykres', dane.wykres_data, dane.wykres_layout);
            
            // Prognoza roczna
            const prognozaMiesieczna = parseFloat(dane.prognoza_miesiac) || 0;
            const progRocznyPrzychod = prognozaMiesieczna * 12;
            
            document.getElementById('progPrzychod').textContent = progRocznyPrzychod.toFixed(2) + ' z';
            
            // Wykres prognozy rocznej
            const miesiace = ['Sty', 'Lut', 'Mar', 'Kwi', 'Maj', 'Cze', 'Lip', 'Sie', 'Wrz', 'Pa藕', 'Lis', 'Gru'];
            const wykresRoczny = [{
                x: miesiace,
                y: Array(12).fill(prognozaMiesieczna),
                type: 'bar',
                marker: {color: '#667eea'}
            }];
            
            Plotly.newPlot('prognozaRocznaWykres', wykresRoczny, {
                title: 'Prognoza miesiczna na cay rok',
                xaxis: {title: 'Miesic'},
                yaxis: {title: 'Przych贸d (z)'},
                height: 300
            });
        }

        async function ladujKilometry() {
            const response = await fetch('/api/kilometry');
            const dane = await response.json();
            
            document.getElementById('calkowitePrzejechane').textContent = dane.calkowite + ' km';
            document.getElementById('przebiegMiesiac').textContent = dane.miesiac + ' km';
            document.getElementById('sredniaDzienKm').textContent = dane.srednia_dzien;
            document.getElementById('kosztNaKm').textContent = dane.koszt_km + ' z';
            
            const koszt = parseFloat(dane.koszt_km) * parseFloat(dane.miesiac);
            document.getElementById('kosztyEksploatacji').textContent = koszt.toFixed(2) + ' z';
        }

        function obliczPodatki() {
            const forma = document.getElementById('formaPodatkowa').value;
            const przychod = parseFloat(document.getElementById('przychodBrutto').value) || 0;
            const typKosztow = document.getElementById('typKosztow').value;
            const dodatkoweKoszty = parseFloat(document.getElementById('dodatkoweKoszty').value) || 0;
            const ulgaNaStart = document.getElementById('ulgaNaStart').value;
            
            let koszty = 0;
            
            // Oblicz koszty uzyskania
            if (forma === 'ryczalt' || forma === 'ryczalt_12') {
                koszty = 0; // Ryczat nie ma koszt贸w uzyskania
            } else {
                if (typKosztow === '20') {
                    koszty = Math.min(przychod * 0.20, 10000); // max 120k rocznie / 12
                } else if (typKosztow === '50') {
                    koszty = przychod * 0.50;
                } else {
                    koszty = parseFloat(document.getElementById('kosztyRzeczywiste').value) || 0;
                }
                koszty += dodatkoweKoszty;
            }
            
            const dochod = przychod - koszty;
            let podatek = 0;
            
            // Oblicz podatek
            if (forma === 'ryczalt') {
                podatek = przychod * 0.085;
            } else if (forma === 'ryczalt_12') {
                podatek = przychod * 0.125;
            } else if (forma === 'liniowy') {
                podatek = dochod * 0.19;
            } else {
                if (dochod <= 120000) {
                    podatek = (dochod * 0.17) - 425; // kwota wolna miesicznie
                } else {
                    podatek = (120000 * 0.17 - 425) + ((dochod - 120000) * 0.32);
                }
            }
            
            podatek = Math.max(podatek, 0);
            
            // Skadka zdrowotna (9% dochodu, max od 60% przecitnego)
            const skladkaZdrowotna = dochod * 0.09;
            
            // ZUS 2025
            const podstawaZUS = 4694.40; // minimalna podstawa
            let zusEmerytalna, zusRentowa, zusChorobowa, zusWypadkowa;
            
            if (ulgaNaStart === 'tak') {
                // Ulga na start - brak ZUS
                zusEmerytalna = 0;
                zusRentowa = 0;
                zusChorobowa = 0;
                zusWypadkowa = 0;
            } else {
                // Normalne skadki
                zusEmerytalna = podstawaZUS * 0.1952;
                zusRentowa = podstawaZUS * 0.08;
                zusChorobowa = podstawaZUS * 0.0245; // dobrowolna
                zusWypadkowa = podstawaZUS * 0.0167;
            }
            
            const zusRazem = zusEmerytalna + zusRentowa + zusChorobowa + zusWypadkowa;
            const sumaObciazen = podatek + skladkaZdrowotna + zusRazem;
            const netto = przychod - sumaObciazen;
            
            // Aktualizacja wywietlania
            document.getElementById('podPrzychod').textContent = przychod.toFixed(2) + ' z';
            document.getElementById('podKoszty').textContent = koszty.toFixed(2) + ' z';
            document.getElementById('podDochod').textContent = dochod.toFixed(2) + ' z';
            document.getElementById('podPIT').textContent = podatek.toFixed(2) + ' z';
            document.getElementById('podZdrowotna').textContent = skladkaZdrowotna.toFixed(2) + ' z';
            document.getElementById('podZUS').textContent = zusRazem.toFixed(2) + ' z';
            document.getElementById('zusEmerytalna').textContent = zusEmerytalna.toFixed(2) + ' z';
            document.getElementById('zusRentowa').textContent = zusRentowa.toFixed(2) + ' z';
            document.getElementById('zusChorobowa').textContent = zusChorobowa.toFixed(2) + ' z';
            document.getElementById('zusWypadkowa').textContent = zusWypadkowa.toFixed(2) + ' z';
            document.getElementById('sumaObciazen').textContent = sumaObciazen.toFixed(2) + ' z';
            document.getElementById('podNetto').textContent = netto.toFixed(2) + ' z';
            
            // Efektywna stawka podatkowa
            const efektywna = (sumaObciazen / przychod * 100).toFixed(1);
            document.getElementById('efektywnaSkladka').innerHTML = `- Efektywna stawka obci偶e: <strong>${efektywna}%</strong>`;
            
            // Prognoza roczna
            document.getElementById('progKoszty').textContent = (koszty * 12).toFixed(2) + ' z';
            document.getElementById('progPodatek').textContent = (podatek * 12).toFixed(2) + ' z';
            document.getElementById('progZUS').textContent = ((zusRazem + skladkaZdrowotna) * 12).toFixed(2) + ' z';
            document.getElementById('progNetto').textContent = (netto * 12).toFixed(2) + ' z';
        }

        function obliczBudzet() {
            const rata = parseFloat(document.getElementById('budRata').value) || 0;
            const ubezpieczenie = parseFloat(document.getElementById('budUbezpieczenie').value) || 0;
            const prowizje = parseFloat(document.getElementById('budProwizje').value) || 0;
            const naprawy = parseFloat(document.getElementById('budNaprawy').value) || 0;
            const inne = parseFloat(document.getElementById('budInne').value) || 0;
            
            const kosztyStale = rata + ubezpieczenie + prowizje + naprawy + inne;
            const podatki = parseFloat(document.getElementById('sumaObciazen').textContent) || 0;
            const przychody = parseFloat(document.getElementById('przychodBrutto').value) || 0;
            
            const zostaje = przychody - kosztyStale - podatki;
            
            document.getElementById('budPrzychody').textContent = przychody.toFixed(2) + ' z';
            document.getElementById('budKosztyStale').textContent = kosztyStale.toFixed(2) + ' z';
            document.getElementById('budPodatki').textContent = podatki.toFixed(2) + ' z';
            document.getElementById('budZostaje').textContent = zostaje.toFixed(2) + ' z';
            
            const wykresData = [{
                values: [kosztyStale, podatki, Math.max(zostaje, 0)],
                labels: ['Koszty stae', 'Podatki i ZUS', 'Do wypaty'],
                type: 'pie',
                marker: {
                    colors: ['#dc3545', '#ffc107', '#28a745']
                }
            }];
            
            const wykresLayout = {
                height: 300,
                margin: {t: 0, b: 0, l: 0, r: 0}
            };
            
            Plotly.newPlot('budWykres', wykresData, wykresLayout);
        }

        function eksportujRaport() {
            alert(' Funkcja eksportu do PDF bdzie wkr贸tce dostpna!\n\nW midzyczasie mo偶esz u偶y funkcji drukowania przegldarki (Ctrl+P).');
            window.print();
        }

        // Zaaduj dane przy starcie
        generujRaport();
        ladujPrognoze();
        ladujKilometry();
        obliczPodatki();
    </script>
</body>
</html>
